-- Adicione esta função ao seu script Ability Wars Hax
local function createAntiDropSystem()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local backpack = player:WaitForChild("Backpack")
    local runService = game:GetService("RunService")

    -- Variáveis de estado
    local currentTool = nil
    local antiDropEnabled = true
    local lastEquipTime = 0

    -- Verifica se uma instância é válida
    local function isValid(instance)
        return instance and instance.Parent ~= nil
    end

    -- Força a reequipagem da ferramenta
    local function forceReequip()
        if not antiDropEnabled or not currentTool or not isValid(currentTool) then 
            return 
        end

        local character = player.Character
        if not character then return end

        local humanoid = character:FindFirstChild("Humanoid")
        if not humanoid then return end

        -- Verifica se a ferramenta já está equipada
        local alreadyEquipped = false
        for _, tool in ipairs(character:GetChildren()) do
            if tool:IsA("Tool") and tool == currentTool then
                alreadyEquipped = true
                break
            end
        end

        -- Reequipa se necessário
        if not alreadyEquipped then
            currentTool.Parent = character
            lastEquipTime = tick()
        end
    end

    -- Monitora a ferramenta ativa
    runService.Heartbeat:Connect(function()
        -- Atualiza a ferramenta atual
        local character = player.Character
        if character then
            for _, tool in ipairs(character:GetChildren()) do
                if tool:IsA("Tool") then
                    currentTool = tool
                    break
                end
            end
        end

        -- Força reequipagem periódica
        if tick() - lastEquipTime > 0.5 then
            forceReequip()
        end
    end)

    -- Previne o drop quando o personagem é atingido
    player.CharacterAdded:Connect(function(character)
        local humanoid = character:WaitForChild("Humanoid")
        
        humanoid.Hurt:Connect(function()
            if antiDropEnabled then
                forceReequip()
            end
        end)
    end)

    -- Previne o drop através de ChildRemoved
    if player.Character then
        player.Character.ChildRemoved:Connect(function(child)
            if antiDropEnabled and child:IsA("Tool") and child == currentTool then
                task.wait(0.1)
                forceReequip()
            end
        end)
    end

    -- Previne transferência para o chão
    workspace.ChildAdded:Connect(function(child)
        if antiDropEnabled and child:IsA("Tool") and child.Name == currentTool.Name then
            child:Destroy() -- Destrói a versão que caiu no chão
            forceReequip()
        end
    end)

    -- Interface de controle
    local antiDropBtn = createButton("Anti-Drop [ON]", 0.7, nil)
    antiDropBtn.MouseButton1Click:Connect(function()
        antiDropEnabled = not antiDropEnabled
        antiDropBtn.Text = antiDropEnabled and "Anti-Drop [ON]" or "Anti-Drop [OFF]"
        antiDropBtn.BackgroundColor3 = antiDropEnabled and 
            Color3.fromRGB(80, 180, 80) or 
            Color3.fromRGB(180, 80, 80)
    end)

    return {
        enable = function() antiDropEnabled = true end,
        disable = function() antiDropEnabled = false end,
        forceEquip = forceReequip
    }
end

-- Inicializa o sistema anti-drop
local antiDropSystem = createAntiDropSystem()
